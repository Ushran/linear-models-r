---
title: "Recap of Statistical Analysis in R"
author: Dominique-Laurent Couturier, Mark Dunning, Rob Nicholls
date: '`r format(Sys.time(), "Last modified: %d %b %Y")`'
output:
  html_notebook:
    toc: yes
    toc_float: yes
---

# Introduction

The purpose

- Reading data into R
- The data-frame representation of data in R
- Selecting rows and columns from a data frame
- Computing numerical summaries
- Basic plotting
- Assessing the key assumptions for a t-test
- Performing a two-sample t-test

## About this tutorial

- The traditional way to enter R commands is via the Terminal, or using the console in RStudio (bottom-left panel when RStudio opens for first time).
- However, for this course we will use a relatively new feature called R-notebooks.
- An R-notebook mixes plain text with R code
    + The R code can be run from inside the document and the results are displayed directly underneath
- Each chunk of R code looks something like this.

```{r}

```

- Each line of R can be executed by clicking on the line and pressing CTRL and ENTER
- Or you can press the green triangle on the right-hand side to run everything in the chunk
    + Try this now!

```{r}
print("Hello World")
```

- You can add R chunks by pressing CRTL + ALT + I
    + or using the Insert menu option
    + (can also include code from other languages such as Python or bash)


# Example Analysis

We will consider the following dataset as an example. 

> Darwin (1876) studied the growth of pairs of zea may (aka corn) seedlings, one produced by cross-fertilization and the other produced by self-fertilization, but otherwise grown under identical conditions. His goal was to demonstrate the greater vigour of the cross-fertilized plants. The data recorded are the final height (inches, to the nearest 1/8th) of the plants in each pair.


## Reading and inspecting the data


Like other software (Word, Excel, Photoshop….), R has a default location where it will save files to and import data from. This is known as the working directory in R. You can query what R currently considers its working directory by executing the following R command:-

```{r}
getwd()
```

*N.B.*Here, a set of open and closed brackets () is used to run the `getwd` function with no arguments.

We can also list the files in this directory with:-

```{r}
list.files()
```

A useful sanity check is the file.exists function which will print TRUE is the file can be found in the working directory.

```{r}
file.exists("zeamays.csv")
```

If the file we want to read is not in the current working directory, we will have to write the *path* to the file; either relative to the current working directory (e.g. the directory “up” from the current working directory, or in a sub-folder), or the full path. In an interactive session, you can run `file.choose` to open a dialogue box. The path to the the file will then be displayed in R.

```{r eval=FALSE}
myfile <- file.choose()
myfile
```

* N.B. The latest version of RStudio (> 1.0.44) provides the option to import data from the File menu. Try File -> Import Dataset -> From Csv.* 


- Assuming the file can be found, we can use the `read.csv` function to import the data. Other functions can be used to read tab-delimited files (read.delim) or a generic read.table function. A data frame object is created.
- The file name `ozone.csv` is the only *argument* to the function `read.csv`
    + arguments are listed inside the brackets
    + for functions requiring more than one argument (input), arguments are separated by commas
    + a function may have default values for some arguments; meaning they do not need to be specified
- The characters `<-` are used to tell R to create a variable
    + without this, the data are not loaded into memory and you won't be able to work with them
- If you get an error saying `Error in file(file, “rt”) : cannot open the connection...`, you might need to change your working directory or make sure the file name is typed correctly (R is case-sensitive)
- Typing the name of an object will cause R to print the contents to the screen

```{r}
zeamays <- read.csv("zeamays.csv")
zeamays
```

** You should always inspect the object after you have created it**. Sometimes R code will run without error, but the result may not be what you were intending

```{r}
tmp <- read.delim("zeamays.csv")
tmp
```


`zeamays` is an example of a data frame. The data frame object in R allows us to work with “tabular” data, like we might be used to dealing with in Excel, where our data can be thought of having rows and columns. The values in each column have to all be of the same type (i.e. all numbers or all text).

## A note on importing your own data

If you are trying to read your own data, and encounter an error at this stage, you may need to consider if your data are in the correct form for analysis. Like most programming languages, R will struggle if your spreadsheet has been heavily formatted to include colours, formulas and special formatting.

These references will guide you through some of the pitfalls and common mistakes to avoid when formatting data

- [Formatting data tables in Spreadsheets](http://www.datacarpentry.org/spreadsheet-ecology-lesson/01-format-data.html)
- [Data Organisation tutorial by Karl Broman](http://kbroman.org/dataorg/)
- [The Quartz guide to bad data](https://github.com/Quartz/bad-data-guide/blob/master/README.md)

## Numerical summaries

```{r}
summary(zeamays)
```


As we saw, typing the name of an object prints all rows and columns to the screen; sometimes not what we sant to see. 

- particular columns can be displayed by putting a `$` sign after the object followed by the name of the column
    + this shows us a different view of the data, and not changing the underlying data
    
```{r}
zeamays$cross
zeamays$self
```

- simple numeric functions can be applied to the data that we extract

```{r}
mean(zeamays$cross)
mean(zeamays$self)
```

- a more-general approach is to put the row and column indices inside square brackets `[]` separated by a comma
    + row indices first, then column indices

```{r}
zeamays[1:5,]
```

## Visualisation 



```{r}
par(mfrow=c(1,2))
hist(zeamays$cross)
hist(zeamays$self)
```


```{r}
boxplot(zeamays, ylab="Height (in)", xlab="Fertilization")

```

## Statistical Testing

The function `t.test` in R can be used to perform statistical testing in many different scenarios

- paired versus independent tests
- one-sample versus two-sample
- two-tailed versus one-tailed


```{r}
t.test(zeamays$cross,zeamays$self)

```

- a two-tailed test is performed
    + we are looking for a difference between the two groups, but don't care which group has a larger mean
- the test statistic is `2.4371`
- the p-value is 0.02328
- the means of each group are 20.19167 and 17.575 respectively

******
******
******

### Exercise

- would an assumption of equal variances be justified?
    + check the boxplot from above
    + HINT the `sd` function is used to calculate standard deviation
- re-run the test with the hypothesis that cross fertilised breed is taller
    + which argument to t-test would you need to change

```{r}


```


******
******
******


In the Design of Experiments, Fisher (1935) used these data to illustrate a paired t-test 


- this can be performed by changing the argument `paired` to be `TRUE`

```{r}
t.test(zeamays$cross,zeamays$self,paired=TRUE)

```

Later in the book (section 21), Fisher also used the data to illustrate an early example of a non-parametric permutation test, treating each paired difference as having (randomly) either a positive or negative sign.

```{r}
wilcox.test(zeamays$cross,zeamays$self)
```


******
******
******

### Exercise


- calculate a new variable to represent the difference between cross and self plants
- perform a one-sample t-test on these data
- compare the results to the paired t-test above
    + what do you notice?
    
```{r}
diff <- zeamays$cross - zeamays$self
t.test(diff)

```

******
******
******
